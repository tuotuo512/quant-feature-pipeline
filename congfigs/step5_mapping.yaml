# ========================================
# Step5: RLç‰¹å¾æ ‡å‡†åŒ–é…ç½®ï¼ˆæç®€ç‰ˆï¼‰
# è·¯å¾„/å‘¨æœŸ/source_mode ä» main_config.yaml ç»§æ‰¿
# æ­¤å¤„ä»…å®šä¹‰ç‰¹å¾åˆ†ç»„ã€æ ‡å‡†åŒ–ç­–ç•¥
# ========================================

# è‡ªåŠ¨è¯†åˆ«é…ç½®ï¼ˆä¼˜å…ˆè¯»å– main.rl_build.source_modeï¼Œæ­¤å¤„ä¸ºå…œåº•ï¼‰
auto_detect:
  periods: null       # null=è‡ªåŠ¨æå–å…¨éƒ¨å‘¨æœŸï¼Œæˆ–ç™½åå• ["3m", "15m", "1h"]
  mode: "auto"        # ä¼˜å…ˆè¯»å– main.rl_build.source_modeï¼›è‹¥æœªæä¾›åˆ™è‡ªåŠ¨æ£€æµ‹

# ========== ç‰¹å¾åˆ†ç»„ï¼ˆgroupsï¼‰==========
# æŒ‰åŠŸèƒ½åˆ†ç»„ï¼Œä¾¿äº Transformer ç†è§£ç‰¹å¾ç»´åº¦
groups:
  market_state:
    source: ["supertrend_direction"]  # ä»è¿™äº›æŒ‡æ ‡æ¨å¯¼
    type: "classification"
    num_classes: 2
  
  momentum:
    source: ["mom"]
    type: "regression"
  
  band_width:
    source: ["bb_width"]
    type: "regression"
  
  volume:
    source: ["volume"]
    type: "regression"
  
  volatility:
    source: ["atr14", "atr14_pct", "rv20", "rv50", "rv100"]
    type: "regression"
  
  rsi_features:
    source: ["rsi14"]
    type: "mixed"  # è¿ç»­å€¼ + äº‹ä»¶æ ‡è®°
  
  time_encoding:
    source: "timestamps"  # ä»æ—¶é—´æˆ³ç”Ÿæˆ
    type: "regression"
  
  price_base:
    source: ["open", "high", "low", "close"]
    periods: ["1m"]  # åªä½¿ç”¨1måŸºå‡†ä»·æ ¼
    type: "regression"

# ========== ç‰¹å¾ç­›é€‰ï¼ˆå¯é€‰ï¼‰==========
filter:
  enabled_groups: []     # ç•™ç©º=å…¨éƒ¨ï¼Œæˆ–æŒ‡å®šç™½åå• ["momentum", "rsi_features", "volume"]
  enabled_periods: []    # ç•™ç©º=å…¨éƒ¨ï¼Œæˆ–æŒ‡å®šç™½åå• ["3m", "15m", "1h"]
  whitelist_columns: []  # ç²¾ç¡®åˆ—åç™½åå•
  blacklist_columns: []  # ç²¾ç¡®åˆ—åé»‘åå•

# ========== ğŸ†ğŸ†ğŸ† çœŸæ»‘çª—é…ç½® (Real Sliding Window) ==========
# ğŸ”¥ æ ¸å¿ƒæ€æƒ³: ç”¨1mæ•°æ®ç›´æ¥è®¡ç®—å¤§å‘¨æœŸæŒ‡æ ‡ï¼Œæ¶ˆé™¤é˜¶è·ƒçªå˜
# ğŸ“Œ é…åˆ main_config.yaml çš„ rl_build.source_mode ä½¿ç”¨
#    - source_mode: "fixed"   â†’ æ­¤é…ç½®ä¸ç”Ÿæ•ˆ
#    - source_mode: "sliding" â†’ æ ¹æ®ä¸‹æ–¹é…ç½®æ‰§è¡ŒçœŸæ»‘çª—

real_sliding:
  # ğŸ¯ é€‚åˆçœŸæ»‘çª—çš„æŒ‡æ ‡ï¼ˆè®¡ç®—ç®€å•ï¼ŒåŸºäºshiftæˆ–rollingï¼‰
  enabled_indicators:
    - "mom"             # âœ… ä»…å¯ç”¨åŠ¨é‡çœŸæ»‘çª—ï¼ˆå…¶ä½™ä¿æŒåŸå§‹å€¼ï¼‰
  
  # ğŸš« ä¸é€‚åˆçœŸæ»‘çª—çš„æŒ‡æ ‡ï¼ˆä¿æŒåŸå§‹å€¼ï¼‰
  # è¿™äº›æŒ‡æ ‡æ¶‰åŠEMA/å¤æ‚ç»Ÿè®¡ï¼ŒçœŸæ»‘çª—æˆæœ¬å¤ªé«˜ï¼š
  #   - rsi14 (éœ€è¦rollingçš„gain/lossç»Ÿè®¡)
  #   - macd/macd_histogram (EMAæŒ‡æ•°åŠ æƒ)
  #   - atr14_pct (éœ€è¦high/low/prev_close)
  #   - supertrend_direction (å¤æ‚é€»è¾‘)
  
  # ğŸ† å¯ç”¨çš„å‘¨æœŸï¼ˆå°å‘¨æœŸä¸éœ€è¦çœŸæ»‘çª—ï¼‰
  target_periods: ["3m", "15m", "30m", "2h"]
  
  # ğŸ”§ é«˜çº§é€‰é¡¹ï¼ˆä»…ä¸æ•°æ®å……è¶³æ€§/ç¼ºå¤±å¡«å……ç›¸å…³ï¼‰
  options:
    min_data_points: 1    # æœ€å°‘éœ€è¦å¤šå°‘æ ¹å†å²æ•°æ®æ‰è®¡ç®—ï¼ˆé˜²æ­¢å†·å¯åŠ¨NaNï¼‰
    fill_method: "ffill"  # ä¸è¶³æ•°æ®æ—¶çš„å¡«å……æ–¹å¼

# ========== æ ‡å‡†åŒ–ç­–ç•¥ï¼ˆæ ¸å¿ƒï¼‰==========
normalization:
  momentum:
    mode: rolling_zscore  # ğŸ”¥ æ»šåŠ¨Z-score + robustå½’ä¸€åŒ–ï¼ˆä¿ç•™ä¿¡æ¯ä¸°å¯Œçš„åŠ¨é‡ä¿¡å·ï¼‰
    norm_method: robust_zscore  # ä½¿ç”¨é²æ£’Z-scoreï¼ˆåŸºäºä¸­ä½æ•°å’ŒMADï¼Œå¯¹æå€¼ä¸æ•æ„Ÿï¼‰
    # âš™ï¸ åŠ¨é‡å›æº¯çª—å£ï¼ˆä¸Step3åŠ¨é‡çª—å£ä¿æŒé€»è¾‘ä¸€è‡´ï¼Œç”±æ­¤å¤„è´Ÿè´£æ§åˆ¶ï¼‰
    default_mom_window: 14  # å¯¹åº”â€œå½“å‰ä»·æ ¼ç›¸å¯¹NæœŸå‰â€çš„N
    # ğŸ” å‚è€ƒä»·æ ¼çš„å–å€¼æ–¹å¼
    #   point:       ç®€å•ROCï¼ˆå½“å‰ close / N æœŸå‰ close - 1ï¼‰
    #   interval_avg: åŒºé—´å‡ä»·å¯¹æ¯”
    #   kline_close:  ä½¿ç”¨åŸºç¡€Kçº¿å‘¨æœŸçš„æ”¶ç›˜ä»·
    momentum_ref_method: "point"
    zscore_window: 100  # æ»šåŠ¨Z-scoreçª—å£ï¼ˆåŸºå‡†å‘¨æœŸï¼‰
    use_period_multipliers_for_zscore: false  # ä¸æŒ‰å‘¨æœŸå€æ•°æ”¾å¤§çª—å£ï¼ˆä¿æŒç»Ÿä¸€ï¼‰
    # é²æ£’å½’ä¸€åŒ–å‚æ•°ï¼ˆæ ¸å¿ƒï¼šé˜²æ­¢æå€¼å‹æ‰ä¿¡å·ï¼‰
    robust_k: 1.4826  # MADåˆ°æ ‡å‡†å·®çš„æ¢ç®—ç³»æ•°ï¼ˆ1.4826ä½¿MADç­‰ä»·äºæ­£æ€åˆ†å¸ƒçš„Ïƒï¼‰
    robust_tanh_scale: 1.0  # Tanhå‹ç¼©çš„å¹³æ»‘ç³»æ•°ï¼ˆè¶Šå°è¶Šé™¡å³­ï¼‰
    post_gain: 2.0  # åå¤„ç†å¢ç›Šï¼ˆæ”¾å¤§ä¿¡å·å¹…åº¦ï¼‰
    # æœ€ç»ˆè£å‰ªåˆ°[-1, 1]ï¼Œä¿è¯æ•°å€¼ç¨³å®šæ€§
  
  band_width:
    mode: fused_rank_smooth
    fast_window: 25
    slow_window: 100
  
  volume:
    mode: rank
    rank_window: 100
  
  volatility:
    mode: fused_rank
    fast_window: 25
    slow_window: 100
  
  rsi:
    mode: linear          # å½’ä¸€åˆ° [-1, 1]ï¼ˆæ–°ç‰ˆï¼šRSIèŒƒå›´ä¸º-100åˆ°+100ï¼‰
    min_persist: 2        # äº‹ä»¶è§¦å‘æœ€å°è¿ç»­æ ¹æ•°
    # ğŸ”¥ æ–°ç‰ˆé˜ˆå€¼ï¼šå¯¹ç§°è®¾è®¡ï¼Œé€‚é…[-100, +100]èŒƒå›´
    # ä¼ ç»Ÿé˜ˆå€¼70/30 â†’ æ–°é˜ˆå€¼+40/-40ï¼ˆè½¬æ¢å…¬å¼ï¼š(70-50)*2=40, (30-50)*2=-40ï¼‰
    upper_threshold: 40.0   # è¶…ä¹°é˜ˆå€¼ï¼ˆå¯¹åº”ä¼ ç»Ÿ70ï¼‰
    lower_threshold: -40.0  # è¶…å–é˜ˆå€¼ï¼ˆå¯¹åº”ä¼ ç»Ÿ30ï¼‰
    # ğŸš€ å½’ä¸€åŒ–ç¼©æ”¾ç³»æ•°ï¼ˆSACä¼˜åŒ–ï¼šæ”¾å¤§ä¿¡å·åˆ†è¾¨ç‡ï¼‰
    # åŸç†ï¼šRSIå®é™…å¾ˆå°‘è¶…è¿‡Â±80ï¼Œä½¿ç”¨80ä½œä¸ºåˆ†æ¯å¯ä»¥è®©å¸¸ç”¨åŒºé—´[-60,+60]
    #      å……åˆ†åˆ©ç”¨[-1,1]ç©ºé—´ï¼Œæå‡SACå¯¹è¶‹åŠ¿å¼ºå¼±çš„æ•æ„Ÿåº¦
    # æ•ˆæœï¼š+80 â†’ 1.0, +60 â†’ 0.75ï¼ˆåŸ0.6ï¼‰ï¼Œä¿¡å·æ”¾å¤§25%
    normalization_divisor: 80.0  # å½’ä¸€åŒ–åˆ†æ¯ï¼ˆé»˜è®¤100ï¼Œæ¨è75-85ï¼‰

# ========== ATRæŒä¹…åŒ–å½’ä¸€åŒ–ï¼ˆè®­ç»ƒ/å®ç›˜ä¸€è‡´ï¼‰ ==========
atr:
  fast_base: 25
  slow_base: 100
  fuse_w_fast: 0.6
  fuse_w_slow: 0.4
  shrink_epsilon: 0.03
  calibration:
    p: 0.95
    target: 0.99
    fixed_quantile: null    # é»˜è®¤ä¸ä½¿ç”¨å…¨å±€å›ºå®šå€¼
    fixed_gamma: null       # å…¨å±€å…œåº•
    per_period:
      "3m":
        fixed_gamma: 0.6231
        fixed_quantile: 0.9840
      "15m":
        fixed_gamma: 0.4282
        fixed_quantile: 0.9768
      "30m":
        fixed_gamma: 0.5239
        fixed_quantile: 0.9810
      "2h":
        fixed_gamma: 0.3578
        fixed_quantile: 0.9723

# ========== è¾“å‡ºé…ç½® ==========
output:
  save_config: true
  save_metadata: true
  validate: true
