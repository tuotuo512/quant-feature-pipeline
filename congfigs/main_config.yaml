version: 1
# /root/FinRL_bn/features_engineering/congfigs/config_loader.py é€šè¿‡å®ƒåˆ†å‘ï¼ï¼ï¼
project:
  name: "finrl_bn"
  mode: "offline"        # offline | backtest | live
  timezone: "UTC"

# ========== äº¤æ˜“æ‰€ä¸äº¤æ˜“å¯¹é…ç½® ==========
exchange:
  name: "okx"                  # binance | okx
  # æ³¨ï¼šäº¤æ˜“æ‰€é€‰æ‹©å½±å“APIç«¯ç‚¹ã€è®¤è¯æ–¹å¼ç­‰

symbol:
  # ğŸ”¥ é‡è¦ï¼štrading_pair_std å’Œ trading_pair_exchange å¿…é¡»å¯¹åº”åŒä¸€å¸ç§ï¼
  # trading_pair_std: ç”¨äºæ–‡ä»¶å‘½åï¼ˆä¸‹åˆ’çº¿æ ¼å¼ï¼‰
  # trading_pair_exchange: ç”¨äºäº¤æ˜“æ‰€APIè°ƒç”¨ï¼ˆæ–œæ æ ¼å¼ï¼‰
  trading_pair_std: "BTC_USDT"     # æ–‡ä»¶å‘½åç»Ÿä¸€ä¸‹åˆ’çº¿
  trading_pair_exchange: "BTC/USDT" # äº¤æ˜“æ‰€æ¥å£ä½¿ç”¨æ–œæ 
  market_type: "swap"              # spot(ç°è´§) | swap(æ°¸ç»­åˆçº¦)
  # æ³¨ï¼šmarket_type ä»…å½±å“åŸå§‹æ•°æ®ä¸‹è½½æ–‡ä»¶åï¼ˆå¦‚ ETH_USDT_SWAP_1m.csvï¼‰
  #     åç»­ Step2-5 å¤„ç†æ—¶ç»Ÿä¸€è¯»å–ï¼Œä¸å†åŒºåˆ† spot/swap
  # 
  # ğŸ¯ åˆ‡æ¢å¸ç§ç¤ºä¾‹ï¼š
  #   ETH: trading_pair_std: "ETH_USDT", trading_pair_exchange: "ETH/USDT"
  #   BTC: trading_pair_std: "BTC_USDT", trading_pair_exchange: "BTC/USDT"

# æ•°æ®ä¸‹è½½æ—¶é—´ã€æ–¹å¼
time_range:
  mode: "incremental"              # incrementalï¼ˆå¢é‡é»˜è®¤ï¼‰ | fullï¼ˆå…¨é‡ï¼‰ | daysï¼ˆæœ€è¿‘Nå¤©ï¼‰ | customï¼ˆè‡ªå®šä¹‰ï¼‰
  incremental:
    days_if_missing: 200         # æœ¬åœ°æ— å†å²æ–‡ä»¶æ—¶,åˆæ¬¡æŠ“å–å¤©æ•°
    fill_missing: true
    initial_start: null


# ========== æ ¸å¿ƒï¼šRLç‰¹å¾æ„å»ºæ¨¡å¼ï¼ˆå”¯ä¸€ä¸»å¼€å…³ï¼‰==========
# fixed:   å›ºå®šKçº¿ï¼Œæ”¶ç›˜æ—¶è·³å˜ï¼ˆè®­ç»ƒé»˜è®¤ï¼Œç¨³å®šå¯é ï¼‰

rl_build:
  source_mode: "fixed"


# å…¨å±€ç»Ÿä¸€å‘¨æœŸ
# åˆæˆå‘¨æœŸ  æ”¯æŒ 2m  3m  10m  2h ç­‰è‡ªå®šä¹‰
timeframes:
  base_download: "1m"
  resample_targets: ["3m", "15m", "30m", "2h"]
  # include_rolling ç”± config_loader è‡ªåŠ¨æ¨å¯¼ï¼Œæ— éœ€æ‰‹åŠ¨é…ç½®
  # å¡«å……é“¾è·¯ï¼ˆç»™ç”µå½±èƒ¶ç‰‡è¡¥å¸§,å‡å°‘åå¤é‡ç®—ã€ä¿è¯è¿ç»­æ€§ï¼‰ ä¸IO.overwrite=false é…åˆä½¿ç”¨
  fill_missing_base: true          # å¯¹step1åŸºç¡€ä¸‹è½½CSV(ETH_USDT_SWAP_1m.csv)è¡¥é½ç½‘æ ¼
  fill_kline_outputs: true         # å¯¹Step2å„å‘¨æœŸKçº¿è¾“å‡ºè¡¥é½ç½‘æ ¼
  fill_indicators: true            # å¯¹Step3æŒ‡æ ‡NaNå¡«å……
  indicators_fill_method: "ffill"  # ffill|bfill|ffill_bfill
  fill_merged: true                # å¯¹Step4 mergedæ–‡ä»¶NaNå¡«å……  è®­ç»ƒç”¨å»ºè®® fill_merged: true
  merged_fill_method: "ffill"      # ffill|bfill|ffill_bfill

# å…¨å±€ç»Ÿä¸€ä¿å­˜è·¯å¾„
io:
  base_dir: "/root/FinRL_bn/data"
  downloads_dir: "{io.base_dir}/rl_live/data_downloads"
  kline_dir: "{io.base_dir}/rl_live/kline"
  indicators_dir: "{io.base_dir}/rl_live/ind"
  merged_dir: "{io.base_dir}/rl_live/merged"
  rl_ready_dir: "{io.base_dir}/rl_live/data_ready"
  
  # ç»Ÿä¸€æ–‡ä»¶å‘½åè§„èŒƒï¼ˆæ‰€æœ‰æ­¥éª¤éµå¾ªï¼‰
  filename_patterns:
    # Step1 ä¸‹è½½: ETH_USDT_SWAP_1m.csv æˆ– ETH_USDT_SPOT_1m.csv
    # æ³¨ï¼š$timeframe$ ç‰¹æ®Šæ ‡è®°é˜²æ­¢è¢« ConfigLoader æå‰æ›¿æ¢ï¼Œç”± IOManager è¿è¡Œæ—¶å¡«å……
    download: "{symbol.trading_pair_std}_{market_type}_$timeframe$.csv"
    
    # Step2 Kçº¿: ETH_USDT_3m.parquet / ETH_USDT_3m_roll.parquet
    kline: "{symbol.trading_pair_std}_$timeframe$.parquet"
    kline_roll: "{symbol.trading_pair_std}_$timeframe$_roll.parquet"
    
    # Step3 æŒ‡æ ‡: ETH_USDT_3m_indicators.parquet
    indicator: "{symbol.trading_pair_std}_$timeframe$_indicators.parquet"
    
    # Step4 èåˆ: ETH_USDT_1m_features.csvï¼ˆbase_download ä½œä¸º timeframeï¼‰
    merged: "{symbol.trading_pair_std}_$timeframe$_merged.parquet"
    
    # Step5 RL: .npz
    rl: "{symbol.trading_pair_std}_rl.npz"
    rl_features: "{symbol.trading_pair_std}_$timeframe$_rl_features.npz"
    rl_labels: "{symbol.trading_pair_std}_$timeframe$_rl_labels.npz"
  
  # ğŸ”¥ output_formatæ§åˆ¶èŒƒå›´: Step2(kline/) + Step3(ind/) + Step4(merged/)
  # Step5åªè¯»å–merged/ï¼Œè‡ªåŠ¨ä¼˜å…ˆParquet (å¿«24å€!)ï¼Œè¾“å‡ºå›ºå®šä¸ºNPZ
  output_format: "parquet"   # csv | parquet | both
                             # - parquet: é€Ÿåº¦å¿«24å€+èŠ‚çœ58%ç©ºé—´ (æ¨è) â­
                             # - csv: é€šç”¨å…¼å®¹æ€§å¥½
                             # - both: ä¸¤ç§éƒ½ç”Ÿæˆ (è°ƒè¯•ç”¨)
  
  overwrite: false           # Step2/3/4æ˜¯å¦è¦†ç›–å·²å­˜åœ¨æ–‡ä»¶   
                             # - false: è·³è¿‡å·²å­˜åœ¨ (å¢é‡æ›´æ–°ï¼Œå¿«) â­â­â­
                             # - true: å¼ºåˆ¶é‡æ–°ç”Ÿæˆ (å®Œæ•´é‡ç®—) å…¨é‡ï¼ï¼éå¸¸æ…¢ï¼ï¼âš ï¸âš ï¸âš ï¸

# æŒ‡æ ‡é…ç½®ï¼ˆå…¨å±€å¯ç”¨åˆ—è¡¨ï¼Œç»†èŠ‚å‚æ•°è§ base_indicators.yamlï¼‰
indicators:
  enabled: ["moving_averages", "supertrend", "momentum", "rsi", "macd", "bollinger_bands", "atr", "volatility"]

merge:
  include_base_ohlcv: true
  align_direction: "backward"
  allow_exact_match: true
  add_timeframe_prefix: true
  
  enable_real_sliding: true                    # æ˜¯å¦å¯ç”¨çœŸæ»‘çª—è®¡ç®—
  real_sliding_indicators: ["mom"]             # éœ€è¦çœŸæ»‘çª—çš„æŒ‡æ ‡åˆ—è¡¨
  real_sliding_window: 14                      # é»˜è®¤åŠ¨é‡çª—å£ï¼ˆå¦‚åˆ—åæ— çª—å£æ•°å­—æ—¶ä½¿ç”¨ï¼‰
  # è¯´æ˜ï¼š
  #   - çœŸæ»‘çª—ç”¨åŸºç¡€å‘¨æœŸ(å¦‚3m)çš„closeï¼Œé‡ç®—å¤§å‘¨æœŸ(å¦‚15m/30m)çš„åŠ¨é‡
  #   - æ•ˆæœï¼šåŠ¨é‡ä¸å†é˜¶è·ƒè·³å˜ï¼Œè€Œæ˜¯å¹³æ»‘è¿‡æ¸¡
  #   - ä¾‹å¦‚ï¼š15m_mom ä¸å†æ˜¯4æ ¹3må¡«å……åŒå€¼ï¼Œè€Œæ˜¯æ¯æ ¹3mé‡ç®—ä¸€æ¬¡

online:
  enabled: false
  source: "okx"    # binance | okx
  poll_interval_ms: 1000
  microbatch:
    length: 2000
    align_to: "1m"

logging:
  verbose: true
  level: "INFO"
  save_log: true
  log_dir: "{io.base_dir}/logs"

validation:
  enforce_strict_naming: true
  timezone: "UTC"

# ========== æ”¶ç›Šç‡ç‰¹å¾æ²»ç†é…ç½® ==========
# ğŸ”¥ å…³é”®æ”¹è¿›ï¼šåœ¨ç‰¹å¾ç”Ÿæˆé˜¶æ®µå°±å®Œæˆæ²»ç†ï¼Œç¡®ä¿è®­ç»ƒ/å®ç›˜ä¸€è‡´
return_feature:
  enable_governance: true           # æ˜¯å¦å¯ç”¨æ”¶ç›Šç‡æ²»ç†ï¼ˆé»˜è®¤å¯ç”¨ï¼‰
  winsorize_p_lo: 0.1              # Winsorizeä¸‹åˆ†ä½æ•°ï¼ˆ0.1%ï¼‰
  winsorize_p_hi: 99.9             # Winsorizeä¸Šåˆ†ä½æ•°ï¼ˆ99.9%ï¼‰
  tanh_scale_factor: 3.0           # Tanhç¼©æ”¾å› å­ï¼ˆ3å€æ ‡å‡†å·®ï¼‰
  # è¯´æ˜ï¼š
  #   1. Winsorize: è£å‰ªæç«¯å€¼åˆ° [0.1%, 99.9%] åˆ†ä½æ•°
  #   2. Tanhå‹ç¼©: å°†æ”¶ç›Šç‡å‹ç¼©åˆ° [-1, 1] èŒƒå›´
  #   3. æ•ˆæœ: é¿å…æç«¯æ”¶ç›Šç‡å½±å“æ¨¡å‹è®­ç»ƒ
  #   4. è®­ç»ƒ/å®ç›˜: ä½¿ç”¨ç›¸åŒé…ç½®ï¼Œç¡®ä¿ç‰¹å¾ä¸€è‡´


