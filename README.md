# ğŸ­ Quant Feature Pipeline | é‡åŒ–äº¤æ˜“ç‰¹å¾åˆ¶é€ æµæ°´çº¿

<p align="center">
  <b>ä»åŸå§‹Kçº¿åˆ°RLè®­ç»ƒç‰¹å¾çš„å·¥ä¸šçº§æµæ°´çº¿</b><br>
  <i>Industrial-grade pipeline: Raw K-line â†’ RL-ready Features</i>
</p>

<p align="center">
  <img src="https://img.shields.io/badge/Python-3.10+-blue.svg" alt="Python">
  <img src="https://img.shields.io/badge/License-MIT-green.svg" alt="License">
  <img src="https://img.shields.io/badge/Status-Production-brightgreen.svg" alt="Status">
</p>

---

## ğŸ¯ è¿™æ˜¯ä»€ä¹ˆï¼Ÿ

ä¸€å¥—**å¼€ç®±å³ç”¨**çš„é‡åŒ–äº¤æ˜“ç‰¹å¾å·¥ç¨‹æµæ°´çº¿ï¼Œä¸“ä¸º**å¼ºåŒ–å­¦ä¹ ï¼ˆRLï¼‰äº¤æ˜“ç³»ç»Ÿ**è®¾è®¡ã€‚

æŠŠæ‚ä¹±çš„ K çº¿æ•°æ®ï¼Œç»è¿‡ 5 æ­¥æ ‡å‡†åŒ–å¤„ç†ï¼Œè¾“å‡ºå¹²å‡€ã€ç»Ÿä¸€ã€å¯ç›´æ¥å–‚ç»™ RL æ¨¡å‹çš„ **NPZ ç‰¹å¾æ–‡ä»¶**ã€‚

```
ğŸ“¥ åŸå§‹Kçº¿ â†’ ğŸ“Š é‡é‡‡æ · â†’ ğŸ“ˆ æŒ‡æ ‡è®¡ç®— â†’ ğŸ”— å¤šå‘¨æœŸèåˆ â†’ ğŸ¤– RLç‰¹å¾
   1åˆ†é’Ÿ        3m/15m/30m/2h    RSI/MACD/ATRç­‰     æ—¶é—´å¯¹é½          NPZæ–‡ä»¶
```

---

## âœ¨ æ ¸å¿ƒç‰¹ç‚¹

### ğŸ”§ å·¥ä¸šçº§è®¾è®¡

| ç‰¹æ€§ | è¯´æ˜ |
|------|------|
| **é…ç½®é©±åŠ¨** | æ‰€æœ‰å‚æ•°é›†ä¸­åœ¨ YAML é…ç½®æ–‡ä»¶ï¼Œæ”¹é…ç½®ä¸æ”¹ä»£ç  |
| **æµæ°´çº¿ç»Ÿä¸€** | è®­ç»ƒã€å›æµ‹ã€å®ç›˜ä½¿ç”¨åŒä¸€å¥—ç‰¹å¾ç”Ÿæˆé€»è¾‘ |
| **å¥‘çº¦æ ¡éªŒ** | å†…ç½® `schema_sha` å“ˆå¸Œï¼Œç¡®ä¿ç¦»çº¿/åœ¨çº¿ç‰¹å¾ä¸€è‡´æ€§ |
| **å¢é‡æ›´æ–°** | æ”¯æŒå¢é‡æ•°æ®ä¸‹è½½å’Œç‰¹å¾æ›´æ–°ï¼ŒèŠ‚çœæ—¶é—´ |

### ğŸ“Š å¤šå‘¨æœŸèåˆ

ä¸åªæ˜¯å•ä¸€æ—¶é—´å‘¨æœŸï¼Œè€Œæ˜¯ **4 å±‚æ—¶é—´å°ºåº¦åŒæ—¶è§‚å¯Ÿ**ï¼š

```
3åˆ†é’Ÿ   â”â”â”â”â”â–º é«˜é¢‘ä¿¡å·ï¼ˆçŸ­çº¿äº¤æ˜“ï¼‰
15åˆ†é’Ÿ  â”â”â”â”â”â–º çŸ­æœŸè¶‹åŠ¿ï¼ˆæ—¥å†…æ³¢æ®µï¼‰
30åˆ†é’Ÿ  â”â”â”â”â”â–º ä¸­æœŸæ–¹å‘ï¼ˆæŒä»“åˆ¤æ–­ï¼‰
2å°æ—¶   â”â”â”â”â”â–º å®è§‚è¶‹åŠ¿ï¼ˆä»“ä½ç®¡ç†ï¼‰
```

### ğŸŒ å¤šå“ç§æ”¯æŒ

ä¸€å¥—ä»£ç ï¼Œé€‚é…å¤šç§èµ„äº§ç±»å‹ï¼š

| å“ç§ç±»å‹ | ç¤ºä¾‹ | æ•°æ®æº |
|----------|------|--------|
| æ•°å­—è´§å¸ | BTCã€ETH | Binanceã€OKX |
| ç¾è‚¡ | AAPLã€TSLA | Alpacaã€Yahoo Finance |
| Aè‚¡ | 600519ã€000001 | Tushareã€AKShare |
| ETF | SPYã€QQQ | åŒä¸Š |

### ğŸ¯ çœŸæ»‘çª—æŠ€æœ¯

è§£å†³ä¼ ç»Ÿå¤šå‘¨æœŸèåˆçš„"é˜¶è·ƒè·³å˜"é—®é¢˜ï¼š

```
âŒ ä¼ ç»Ÿæ–¹æ¡ˆï¼ˆé˜¶è·ƒï¼‰          âœ… çœŸæ»‘çª—æ–¹æ¡ˆï¼ˆå¹³æ»‘ï¼‰
12:00 â” 15m_mom = 0.14      12:00 â” 15m_mom = 0.14
12:03 â” 15m_mom = 0.14      12:03 â” 15m_mom = 0.16  â† å®æ—¶é‡ç®—
12:06 â” 15m_mom = 0.14      12:06 â” 15m_mom = 0.19
12:09 â” 15m_mom = 0.14      12:09 â” 15m_mom = 0.22
12:12 â” 15m_mom = 0.14      12:12 â” 15m_mom = 0.25
12:15 â” 15m_mom = 0.40 âš¡   12:15 â” 15m_mom = 0.40
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
pip install pandas numpy ccxt ta pyyaml pyarrow
```

### 2. é…ç½®å“ç§

```yaml
# congfigs/main_config.yaml
symbol:
  trading_pair_std: "BTC_USDT"      # å“ç§æ ‡è¯†
  trading_pair_exchange: "BTC/USDT" # APIæ ¼å¼
  market_type: "swap"               # å¸‚åœºç±»å‹
```

### 3. è¿è¡Œæµæ°´çº¿

```bash
# ä¸‹è½½æ•°æ®
python run1_step1_data.py --exchange okx --symbol BTC/USDT --days 90

# ç”Ÿæˆç‰¹å¾ï¼ˆä¸€é”®å®Œæˆ Step2-5ï¼‰
python run2_offline_pipeline.py
```

### 4. ä½¿ç”¨è¾“å‡º

```python
import numpy as np

# åŠ è½½ç‰¹å¾æ–‡ä»¶
with np.load("data/rl_live/data_ready/BTC_USDT_3m_rl_features.npz", allow_pickle=True) as z:
    features = z["observations"]      # (N, 45) ç‰¹å¾çŸ©é˜µ
    timestamps = z["timestamps"]      # (N,) æ—¶é—´æˆ³
    prices = z["prices"]              # (N, 4) OHLCä»·æ ¼
    feature_names = z["feature_names"] # ç‰¹å¾åç§°åˆ—è¡¨

print(f"æ ·æœ¬æ•°: {features.shape[0]:,}")
print(f"ç‰¹å¾æ•°: {features.shape[1]}")
```

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
features_engineering/
â”œâ”€â”€ congfigs/                    # ğŸ“‹ é…ç½®ä¸­å¿ƒ
â”‚   â”œâ”€â”€ main_config.yaml         #    ä¸»é…ç½®ï¼ˆå“ç§ã€å‘¨æœŸã€è·¯å¾„ï¼‰
â”‚   â”œâ”€â”€ base_indicators.yaml     #    æŒ‡æ ‡å‚æ•°ï¼ˆRSIã€MACDçª—å£ç­‰ï¼‰
â”‚   â””â”€â”€ step5_mapping.yaml       #    ç‰¹å¾æ˜ å°„ä¸å½’ä¸€åŒ–
â”‚
â”œâ”€â”€ step1_data.py                # ğŸ“¥ Step1: æ•°æ®ä¸‹è½½
â”œâ”€â”€ step2_resample.py            # ğŸ“Š Step2: æ—¶é—´é‡é‡‡æ ·
â”œâ”€â”€ step3_generate_indicators.py # ğŸ“ˆ Step3: æŒ‡æ ‡è®¡ç®—
â”œâ”€â”€ step4_merge_features.py      # ğŸ”— Step4: å¤šå‘¨æœŸèåˆ
â”œâ”€â”€ step5_featueres_unified.py   # ğŸ¤– Step5: RLç‰¹å¾å¯¼å‡º
â”‚
â”œâ”€â”€ run1_step1_data.py           # ğŸ¬ è¿è¡Œå…¥å£ï¼šæ•°æ®ä¸‹è½½
â”œâ”€â”€ run2_offline_pipeline.py     # ğŸ¬ è¿è¡Œå…¥å£ï¼šå®Œæ•´æµæ°´çº¿
â”œâ”€â”€ unified_feature_pipeline.py  # ğŸ”Œ ç»Ÿä¸€æ¥å£ï¼ˆä¾›å¤–éƒ¨è°ƒç”¨ï¼‰
â”‚
â”œâ”€â”€ tools/                       # ğŸ”§ å·¥å…·æ¨¡å—
â”‚   â”œâ”€â”€ io_paths.py              #    è·¯å¾„ç®¡ç†
â”‚   â”œâ”€â”€ real_sliding_simple.py   #    çœŸæ»‘çª—å®ç°
â”‚   â””â”€â”€ export_utils.py          #    å¯¼å‡ºå·¥å…·
â”‚
â””â”€â”€ docs/                        # ğŸ“š æ–‡æ¡£
    â”œâ”€â”€ ğŸ“ å¤šå“ç§ç‰¹å¾å·¥ç¨‹æ ‡å‡†.md
    â””â”€â”€ ğŸ“Š RLç‰¹å¾æ•°æ®è§„æ ¼è¯´æ˜.md
```

---

## ğŸ“Š è¾“å‡ºç‰¹å¾è§„æ ¼

### ç‰¹å¾åˆ†ç»„ï¼ˆ45ç»´ï¼‰

| åˆ†ç»„ | ç»´åº¦ | å–å€¼èŒƒå›´ | è¯´æ˜ |
|------|------|----------|------|
| å¸‚åœºçŠ¶æ€ | 4 | {-1, 1} | SuperTrendè¶‹åŠ¿æ–¹å‘ |
| åŠ¨é‡ | 4 | [-1, 1] | ä»·æ ¼åŠ¨é‡ï¼ˆçœŸæ»‘çª—ï¼‰ |
| æ³¢åŠ¨å¸¦å®½ | 4 | [0, 1] | å¸ƒæ—å¸¦å®½åº¦ |
| æˆäº¤é‡ | 4 | [0, 1] | åˆ†ä½æ•°å½’ä¸€åŒ– |
| ATR% | 4 | [0, âˆ) | æ³¢åŠ¨ç‡/ä»·æ ¼ |
| å·²å®ç°æ³¢åŠ¨ç‡ | 4 | [0, 0.1] | å¯¹æ•°æ”¶ç›Šæ–¹å·® |
| RSIç³»åˆ— | 12 | [-1, 1] | RSI + è¶…ä¹°è¶…å–äº‹ä»¶ |
| æ—¶é—´ç¼–ç  | 4 | [-1, 1] | sin/coså‘¨æœŸç¼–ç  |
| ä»·æ ¼ | 4 | åŸå§‹å€¼ | OHLC |
| æ”¶ç›Šç‡ | 1 | [-1, 1] | å¯¹æ•°æ”¶ç›Šç‡ |

### NPZ æ–‡ä»¶ç»“æ„

```python
{
    'version': '1.0',
    'observations': (N, 45),      # ç‰¹å¾çŸ©é˜µ
    'feature_names': [...],       # ç‰¹å¾åç§°
    'feature_groups': [...],      # ç‰¹å¾åˆ†ç»„
    'timestamps': (N,),           # æ—¶é—´æˆ³
    'prices': (N, 4),             # OHLCä»·æ ¼
    'schema_sha': '...',          # å¥‘çº¦å“ˆå¸Œ
    'metadata': {...}             # å…ƒä¿¡æ¯
}
```

---

## ğŸ”Œ æ‰©å±•æŒ‡å—

### æ·»åŠ æ–°å“ç§

1. **ä¿®æ”¹é…ç½®**ï¼š`congfigs/main_config.yaml` ä¸­è®¾ç½®å“ç§æ ‡è¯†
2. **å®ç°ä¸‹è½½å™¨**ï¼šå¦‚éœ€æ–°æ•°æ®æºï¼Œåœ¨ `step1_data.py` æ·»åŠ ä¸‹è½½ç±»
3. **è¿è¡Œæµæ°´çº¿**ï¼šæ‰§è¡Œ `run2_offline_pipeline.py`

### æ·»åŠ æ–°æŒ‡æ ‡

1. **é…ç½®æŒ‡æ ‡**ï¼š`base_indicators.yaml` æ·»åŠ å‚æ•°
2. **å®ç°è®¡ç®—**ï¼š`step3_generate_indicators.py` æ·»åŠ è®¡ç®—é€»è¾‘
3. **æ˜ å°„è¾“å‡º**ï¼š`step5_mapping.yaml` é…ç½®å½’ä¸€åŒ–

### å¯¹æ¥ RL æ¡†æ¶

æœ¬æµæ°´çº¿è¾“å‡ºçš„ NPZ æ–‡ä»¶å¯ç›´æ¥ç”¨äºï¼š

- **Stable-Baselines3**ï¼šä½œä¸º `VecEnv` çš„è§‚å¯Ÿç©ºé—´
- **RLlib**ï¼šä½œä¸ºè‡ªå®šä¹‰ç¯å¢ƒçš„çŠ¶æ€
- **è‡ªç ”æ¡†æ¶**ï¼šæ ‡å‡† NumPy æ ¼å¼ï¼Œé€šç”¨å…¼å®¹

---

## ğŸ” å®‰å…¨è¯´æ˜

**API å¯†é’¥ä»ç¯å¢ƒå˜é‡è¯»å–ï¼Œä¸ä¼šç¡¬ç¼–ç åœ¨ä»£ç ä¸­**ï¼š

```bash
# ~/.bashrc
export OKX_API_KEY="your_key"
export OKX_API_SECRET="your_secret"
export BINANCE_API_KEY="your_key"
```

**å·²åœ¨ `.gitignore` ä¸­æ’é™¤**ï¼š
- `data/` æ•°æ®ç›®å½•
- `.env` ç¯å¢ƒé…ç½®
- `*.npz` ç‰¹å¾æ–‡ä»¶

---

## ğŸ“‹ é€‚ç”¨åœºæ™¯

| åœºæ™¯ | æ˜¯å¦é€‚ç”¨ | è¯´æ˜ |
|------|----------|------|
| RL é‡åŒ–äº¤æ˜“ | âœ… å®Œç¾é€‚é… | ä¸“ä¸º RL è®¾è®¡çš„ç‰¹å¾æ ¼å¼ |
| ä¼ ç»Ÿ ML ç­–ç•¥ | âœ… é€‚ç”¨ | è¾“å‡ºæ ‡å‡† NumPy æ•°ç»„ |
| å›æµ‹ç³»ç»Ÿ | âœ… é€‚ç”¨ | åŒ…å«å®Œæ•´æ—¶é—´æˆ³å’Œä»·æ ¼ |
| å®ç›˜äº¤æ˜“ | âœ… é€‚ç”¨ | æ”¯æŒåœ¨çº¿ç‰¹å¾ç”Ÿæˆ |
| é«˜é¢‘äº¤æ˜“ | âš ï¸ éœ€è°ƒæ•´ | é»˜è®¤æœ€å°å‘¨æœŸ 1mï¼Œå¯æ‰©å±• |

---

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ PRï¼

å¦‚æœå¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™ä¸ª â­ Starï¼

---

## ğŸ“„ License

MIT License

---

<p align="center">
  <b>è®©ç‰¹å¾å·¥ç¨‹ä¸å†æ˜¯é‡åŒ–äº¤æ˜“çš„ç“¶é¢ˆ</b>
</p>

